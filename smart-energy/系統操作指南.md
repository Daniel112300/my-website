# ğŸ“š Smart Energy ç³»çµ±å®Œæ•´æ“ä½œæŒ‡å—

> **é©ç”¨å°è±¡**ï¼šæ‰€æœ‰åœ˜éšŠæˆå“¡ï¼ˆå‰ç«¯ã€å¾Œç«¯ã€æ¸¬è©¦ï¼‰  
> **æœ€å¾Œæ›´æ–°**ï¼š2025-11-30  
> **ç³»çµ±ç‰ˆæœ¬**ï¼šv1.1

---

## ğŸ¯ ç³»çµ±æ¶æ§‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Flask å¾Œç«¯ä¼ºæœå™¨                   â”‚
â”‚         (python app.py å•Ÿå‹•)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  4å€‹åŠŸèƒ½   â”‚   â”‚   MySQL     â”‚
â”‚  æ¨¡çµ„      â”‚â—„â”€â–ºâ”‚  è³‡æ–™åº«     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ æä¾› 19 å€‹ API ç«¯é»
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ï¼ˆå¾…é–‹ç™¼ï¼‰æˆ– API æ¸¬è©¦å·¥å…·   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ å››å¤§åŠŸèƒ½æ¨¡çµ„

| æ¨¡çµ„ | æª”æ¡ˆ | åŠŸèƒ½ | API æ•¸é‡ |
|------|------|------|---------|
| **åŠŸèƒ½1** | `feature_device_control.py` | é›»å™¨é–‹é—œæ§åˆ¶ | 5 |
| **åŠŸèƒ½2** | `feature_daily_usage.py` | æ¯æ—¥ç”¨é›»çµ±è¨ˆ | 8 |
| **åŠŸèƒ½3** | `feature_temp_auto.py` | æº«åº¦è‡ªå‹•æ§åˆ¶ | 8 |
| **åŠŸèƒ½4** | `feature_simulator.py` | è³‡æ–™æ¨¡æ“¬å™¨ | 5 |

**ç¸½è¨ˆ**ï¼š**26 å€‹ API ç«¯é»**

---

## ğŸš€ å¿«é€Ÿé–‹å§‹ï¼ˆ3 æ­¥é©Ÿï¼‰

### æ­¥é©Ÿ 1ï¼šå•Ÿå‹•ä¼ºæœå™¨

```powershell
cd "d:\é€¢ç”²åŠŸèª²\å¤§ä¸‰\å¤§ä¸‰_ä¸Š\è»Ÿé«”å·¥ç¨‹é–‹ç™¼å¯¦å‹™\my-website\smart-energy"
python app.py
```

âœ… **çœ‹åˆ°é€™å€‹è¡¨ç¤ºæˆåŠŸï¼š**
```
* Running on http://127.0.0.1:5000
* Debug mode: on
```

âš ï¸ **é‡è¦ï¼šå•Ÿå‹•ä¼ºæœå™¨ä¸æœƒç”¢ç”Ÿä»»ä½•æ•¸æ“šï¼**

---

### æ­¥é©Ÿ 2ï¼šæ¸¬è©¦ APIï¼ˆé¸ä¸€å€‹è©¦è©¦ï¼‰

#### æ–¹æ³• Aï¼šç”¨ç€è¦½å™¨
```
http://127.0.0.1:5000/device/state
```

#### æ–¹æ³• Bï¼šç”¨ PowerShell
```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:5000/device/state"
```

#### æ–¹æ³• Cï¼šç”¨ Python
```python
import requests
r = requests.get("http://127.0.0.1:5000/device/state")
print(r.json())
```

---

### æ­¥é©Ÿ 3ï¼šç”¢ç”Ÿæ¸¬è©¦æ•¸æ“šï¼ˆé¸æ“‡æ€§ï¼‰

```powershell
# ç”¢ç”Ÿ 12 æœˆ 1-7 è™Ÿçš„æ¸¬è©¦æ•¸æ“š
$body = @{
    start_date = "2025-12-01"
    end_date = "2025-12-07"
    save_to_db = $true
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/range" `
  -Method POST `
  -Body $body `
  -ContentType "application/json"
```

---

## ğŸ“‹ åŠŸèƒ½ 1ï¼šé›»å™¨é–‹é—œæ§åˆ¶

### ç”¨é€”
- æŸ¥çœ‹æ‰€æœ‰è¨­å‚™çš„é–‹é—œç‹€æ…‹
- é ç«¯æ§åˆ¶è¨­å‚™é–‹é—œ
- æŸ¥çœ‹æ‰€æœ‰è¨­å‚™è©³ç´°è³‡è¨Š
- æ–°å¢è¨­å‚™
- åˆªé™¤è¨­å‚™

### API ç«¯é»ï¼ˆ5 å€‹ï¼‰

#### 1.1 æŸ¥çœ‹æ‰€æœ‰è¨­å‚™ç‹€æ…‹
```http
GET /device/state
```

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "ok": true,
  "state": {
    "å®¢å»³LEDç‡ˆ": false,
    "å®¢å»³å†·æ°£": true,
    "æ›¸æˆ¿æª¯ç‡ˆ": false
  }
}
```

#### 1.2 åˆ‡æ›è¨­å‚™é–‹é—œ
```http
PATCH /device/toggle
Content-Type: application/json

{
  "name": "å®¢å»³å†·æ°£",
  "on": true
}
```

### ä½¿ç”¨ç¯„ä¾‹

```powershell
# æŸ¥çœ‹ç‹€æ…‹
Invoke-RestMethod -Uri "http://127.0.0.1:5000/device/state"

# é–‹å•Ÿå®¢å»³å†·æ°£
$body = @{ name = "å®¢å»³å†·æ°£"; on = $true } | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/device/toggle" `
  -Method PATCH -Body $body -ContentType "application/json"

# é—œé–‰å®¢å»³å†·æ°£
$body = @{ name = "å®¢å»³å†·æ°£"; on = $false } | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/device/toggle" `
  -Method PATCH -Body $body -ContentType "application/json"
```

#### 1.3 æŸ¥çœ‹æ‰€æœ‰è¨­å‚™åˆ—è¡¨ï¼ˆå«è©³ç´°è³‡è¨Šï¼‰
```http
GET /device/list
```

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "ok": true,
  "devices": [
    {
      "device_id": 1,
      "device_name": "å®¢å»³å†·æ°£",
      "device_type": "air_conditioner",
      "model_number": "AC-2023",
      "location": "å®¢å»³",
      "rated_power": 3200.0,
      "is_active": true,
      "user_id": 1,
      "status": {
        "is_on": true,
        "current_temperature": 28.5,
        "target_temperature": 26.0,
        "mode": "cooling"
      }
    }
  ],
  "count": 5
}
```

```powershell
# æŸ¥çœ‹æ‰€æœ‰è¨­å‚™åˆ—è¡¨
Invoke-RestMethod -Uri "http://127.0.0.1:5000/device/list"
```

#### 1.4 æ–°å¢è¨­å‚™
```http
POST /device/add
Content-Type: application/json

{
  "user_id": 1,
  "device_name": "è‡¥å®¤æª¯ç‡ˆ",
  "device_type": "light",
  "model_number": "LED-100",
  "location": "è‡¥å®¤",
  "rated_power": 15,
  "is_active": true
}
```

```powershell
# æ–°å¢è¨­å‚™
$body = @{
    user_id = 1
    device_name = "è‡¥å®¤æª¯ç‡ˆ"
    device_type = "light"
    model_number = "LED-100"
    location = "è‡¥å®¤"
    rated_power = 15
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://127.0.0.1:5000/device/add" `
  -Method POST -Body $body -ContentType "application/json"
```

#### 1.5 åˆªé™¤è¨­å‚™
```http
DELETE /device/remove/<device_id>
```

```powershell
# åˆªé™¤ device_id = 10 çš„è¨­å‚™
Invoke-RestMethod -Uri "http://127.0.0.1:5000/device/remove/10" -Method DELETE
```

---

## ğŸ“Š åŠŸèƒ½ 2ï¼šæ¯æ—¥ç”¨é›»çµ±è¨ˆ

### ç”¨é€”
- æŸ¥è©¢æ¯æ—¥/æ¯æœˆ/æ¯å¹´ç”¨é›»é‡
- è¨ˆç®—å°é›»ç´¯é€²è²»ç‡é›»è²»
- æ¯”è¼ƒä¸åŒæ™‚é–“æ®µç”¨é›»
- æ–°å¢ç”¨é›»è¨˜éŒ„

### API ç«¯é»ï¼ˆ8 å€‹ï¼‰

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/usage/daily` | GET | æ¯æ—¥çµ±è¨ˆï¼ˆé è¨­è¿‘ 7 å¤©ï¼‰ |
| `/usage/monthly/<year>/<month>` | GET | æœˆçµ±è¨ˆ |
| `/usage/yearly/<year>` | GET | å¹´çµ±è¨ˆ |
| `/usage/bill` | POST | é›»è²»è©¦ç®— |
| `/usage/compare` | GET | æ™‚é–“æ®µæ¯”è¼ƒ |
| `/usage/add` | POST | æ–°å¢å–®ç­†è¨˜éŒ„ |
| `/usage/batch` | POST | æ‰¹æ¬¡æ–°å¢ |

### ä½¿ç”¨ç¯„ä¾‹

#### æŸ¥è©¢æ¯æ—¥ç”¨é›»ï¼ˆé è¨­è¿‘ 7 å¤©ï¼‰
```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/daily"
```

**âš ï¸ é‡è¦ï¼šé è¨­é¡¯ç¤ºä»Šå¤©å¾€å‰æ¨ 7 å¤©**
- ä»Šå¤©æ˜¯ 11/30 â†’ é¡¯ç¤º 11/24 ~ 11/30
- å³ä½¿è³‡æ–™åº«æœ‰ 12 æœˆæ•¸æ“šï¼Œé è¨­ä¹Ÿä¸æœƒé¡¯ç¤º

#### æŸ¥è©¢æŒ‡å®šæ—¥æœŸç¯„åœ
```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/daily?start_date=2025-12-01&end_date=2025-12-07"
```

#### æŸ¥è©¢å–®æœˆçµ±è¨ˆ
```powershell
# æŸ¥è©¢ 2025 å¹´ 11 æœˆ
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/monthly/2025/11"
```

#### é›»è²»è©¦ç®—
```powershell
$body = @{ kwh = 330; month = 7 } | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/bill" `
  -Method POST -Body $body -ContentType "application/json"
```

#### æ™‚é–“æ®µæ¯”è¼ƒ
```powershell
# æ¯”è¼ƒ 10 æœˆå’Œ 11 æœˆ
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/compare?period_type=month&date1=2025-10&date2=2025-11"
```

---

## ğŸŒ¡ï¸ åŠŸèƒ½ 3ï¼šæº«åº¦è‡ªå‹•æ§åˆ¶

### ç”¨é€”
- è‡ªå‹•è®€å–æº«åº¦ä¸¦æ§åˆ¶å†·æ°£
- èƒŒæ™¯ç›£æ§ï¼ˆæ¯ 3 åˆ†é˜è‡ªå‹•æª¢æŸ¥ï¼‰
- ç³»çµ±è¨­å®šï¼ˆç›®æ¨™æº«åº¦ã€ç›£æ§é–“éš”ï¼‰

### API ç«¯é»ï¼ˆ8 å€‹ï¼‰

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/auto/check` | GET | ğŸ”¥ **ç«‹å³æª¢æŸ¥ä¸¦æ§åˆ¶**ï¼ˆæ¨è–¦ï¼‰ |
| `/auto/monitor/start` | POST | å•Ÿå‹•èƒŒæ™¯ç›£æ§ |
| `/auto/monitor/stop` | POST | åœæ­¢èƒŒæ™¯ç›£æ§ |
| `/auto/monitor/status` | GET | æŸ¥è©¢ç›£æ§ç‹€æ…‹ |
| `/auto/config` | GET | æŸ¥çœ‹ç³»çµ±è¨­å®š |
| `/auto/config` | POST | ä¿®æ”¹ç³»çµ±è¨­å®š |
| `/auto/decide` | GET/POST | æ‰‹å‹•æ¸¬è©¦ï¼ˆçµ¦å‰ç«¯ç”¨ï¼‰ |

### æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªå‹•æº«åº¦æª¢æŸ¥

```powershell
# ç«‹å³æª¢æŸ¥æº«åº¦ä¸¦æ§åˆ¶æ‰€æœ‰å†·æ°£
Invoke-RestMethod -Uri "http://127.0.0.1:5000/auto/check"
```

**ç³»çµ±æœƒè‡ªå‹•ï¼š**
1. å¾è³‡æ–™åº«è®€å–æœ€æ–°æº«åº¦ï¼ˆ`EnvironmentLog` è¡¨ï¼‰
2. å¦‚æœæ²’æœ‰è³‡æ–™ï¼Œå‘¼å«æ¨¡æ“¬å™¨è¨ˆç®—æº«åº¦
3. èˆ‡ç›®æ¨™æº«åº¦ï¼ˆé è¨­ 26Â°Cï¼‰æ¯”è¼ƒ
4. è‡ªå‹•é–‹å•Ÿæˆ–é—œé–‰**æ‰€æœ‰å†·æ°£è¨­å‚™**
5. æ›´æ–°è³‡æ–™åº«ä¸­çš„è¨­å‚™ç‹€æ…‹

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "ok": true,
  "current_temp": 23.3,
  "target_temp": 26.0,
  "action": "turn_off",
  "reason": "ç›®å‰æº«åº¦ 23.3Â°C ä½æ–¼ç›®æ¨™ 26.0Â°Cï¼Œé—œé–‰å†·æ°£",
  "timestamp": "2025-11-30 17:47:34",
  "devices_controlled": [
    {"device_id": 2, "device_name": "å®¢å»³å†·æ°£", "action": "turn_off", "success": true},
    {"device_id": 5, "device_name": "è‡¥å®¤å†·æ°£", "action": "turn_off", "success": true}
  ]
}
```

### èƒŒæ™¯ç›£æ§ï¼ˆæ¯ 3 åˆ†é˜è‡ªå‹•åŸ·è¡Œï¼‰

```powershell
# å•Ÿå‹•ç›£æ§ï¼ˆæ¯ 180 ç§’æª¢æŸ¥ä¸€æ¬¡ï¼‰
$body = @{ interval = 180 } | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/auto/monitor/start" `
  -Method POST -Body $body -ContentType "application/json"

# æŸ¥è©¢ç›£æ§ç‹€æ…‹
Invoke-RestMethod -Uri "http://127.0.0.1:5000/auto/monitor/status"

# åœæ­¢ç›£æ§
Invoke-RestMethod -Uri "http://127.0.0.1:5000/auto/monitor/stop" -Method POST
```

### ä¿®æ”¹ç³»çµ±è¨­å®š

```powershell
# æŸ¥çœ‹ç•¶å‰è¨­å®š
Invoke-RestMethod -Uri "http://127.0.0.1:5000/auto/config"

# ä¿®æ”¹ç›®æ¨™æº«åº¦ç‚º 25Â°Cï¼Œç›£æ§é–“éš”ç‚º 2 åˆ†é˜
$body = @{ target_temp = 25.0; monitor_interval = 120 } | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/auto/config" `
  -Method POST -Body $body -ContentType "application/json"
```

---

## ğŸ² åŠŸèƒ½ 4ï¼šè³‡æ–™æ¨¡æ“¬å™¨

### ç”¨é€”
- ç”¢ç”Ÿæ¸¬è©¦ç”¨çš„ç”¨é›»æ•¸æ“š
- æ¨¡æ“¬æº«åº¦è®ŠåŒ–
- ä¸éœ€è¦çœŸå¯¦ç¡¬é«”å³å¯é–‹ç™¼

### âš ï¸ é‡è¦è§€å¿µ

**æ¨¡æ“¬å™¨ä¸æœƒè‡ªå‹•åŸ·è¡Œï¼**
- âŒ å•Ÿå‹•ä¼ºæœå™¨ä¸æœƒç”¢ç”Ÿæ•¸æ“š
- âŒ é‡å•Ÿä¼ºæœå™¨ä¸æœƒå¢åŠ è¨˜éŒ„
- âŒ æ²’æœ‰å®šæ™‚è‡ªå‹•ç”¢ç”ŸåŠŸèƒ½
- âœ… **å¿…é ˆæ‰‹å‹•å‘¼å« API** æ‰æœƒç”¢ç”Ÿæ•¸æ“š

### API ç«¯é»ï¼ˆ5 å€‹ï¼‰

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/simulate/daily` | POST | æ¨¡æ“¬å–®æ—¥ç”¨é›» |
| `/simulate/range` | POST | æ‰¹æ¬¡æ¨¡æ“¬å¤šå¤© |
| `/simulate/temperature` | GET | è¨ˆç®—æŒ‡å®šæ™‚åˆ»æº«åº¦ |
| `/simulate/config` | GET | æŸ¥çœ‹æ¨¡æ“¬å™¨è¨­å®š |
| `/simulate/stats` | GET | è³‡æ–™åº«çµ±è¨ˆ |

### ä½¿ç”¨ç¯„ä¾‹

#### é è¦½å–®æ—¥æ•¸æ“šï¼ˆä¸å­˜è³‡æ–™åº«ï¼‰
```powershell
$body = @{
    date = "2025-12-15"
    save_to_db = $false
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/daily" `
  -Method POST -Body $body -ContentType "application/json"
```

#### ç”¢ç”Ÿä¸€é€±æ•¸æ“šä¸¦å­˜å…¥è³‡æ–™åº«
```powershell
$body = @{
    start_date = "2025-12-01"
    end_date = "2025-12-07"
    save_to_db = $true
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/range" `
  -Method POST -Body $body -ContentType "application/json"
```

#### æŸ¥è©¢æŒ‡å®šæ™‚åˆ»æº«åº¦
```powershell
# æŸ¥è©¢ 7 æœˆ 15 æ—¥ä¸‹åˆ 2 é»çš„æº«åº¦
Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/temperature?date=2025-07-15&hour=14"
```

#### æŸ¥çœ‹è³‡æ–™åº«çµ±è¨ˆ
```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/stats"
```

### æ¨¡æ“¬å™¨ç”¢ç”Ÿçš„æ•¸æ“š

#### æœƒå¯«å…¥è³‡æ–™åº«ï¼š
- âœ… **ç”¨é›»è¨˜éŒ„**ï¼ˆ`power_logs` è¡¨ï¼‰
  - device_id, power_watts, hours, kwh, log_date

#### ä¸æœƒè‡ªå‹•å¯«å…¥ï¼š
- âŒ **æº«åº¦è¨˜éŒ„**ï¼ˆåªè¨ˆç®—ï¼Œä¸å­˜å…¥ `environment_logs`ï¼‰

### æ¨¡æ“¬æ•¸æ“š vs çœŸå¯¦æ•¸æ“š

| é …ç›® | èªªæ˜ |
|------|------|
| **å¯«å…¥ä½ç½®** | åŒä¸€å€‹ `power_logs` è¡¨ |
| **èƒ½å¦å€åˆ†** | âŒ ç„¡æ³•è‡ªå‹•å€åˆ† |
| **æœƒé¡¯ç¤ºåœ¨ `/usage/daily` å—** | âœ… æœƒï¼å®Œå…¨ä¸€æ¨£ |
| **å»ºè­°åšæ³•** | çœŸå¯¦æ•¸æ“šèˆ‡æ¨¡æ“¬æ•¸æ“šç”¨ä¸åŒæ—¥æœŸç¯„åœ |

---

## ğŸ¯ å¸¸è¦‹ä½¿ç”¨æƒ…å¢ƒ

### æƒ…å¢ƒ 1ï¼šå‰ç«¯é–‹ç™¼éœ€è¦æ¸¬è©¦æ•¸æ“š

```powershell
# 1. ç”¢ç”Ÿæ•´å€‹ 12 æœˆçš„æ•¸æ“š
$body = @{
    start_date = "2025-12-01"
    end_date = "2025-12-31"
    save_to_db = $true
    seed = 2025  # å›ºå®šç¨®å­ï¼Œç¢ºä¿æ‰€æœ‰çµ„å“¡æ•¸æ“šä¸€è‡´
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/range" `
  -Method POST -Body $body -ContentType "application/json"

# 2. æŸ¥è©¢æ•¸æ“šé©—è­‰
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/monthly/2025/12"
```

---

### æƒ…å¢ƒ 2ï¼šæ¸¬è©¦æº«åº¦è‡ªå‹•æ§åˆ¶

```powershell
# 1. å•Ÿå‹•èƒŒæ™¯ç›£æ§ï¼ˆæ¯ 3 åˆ†é˜ï¼‰
$body = @{ interval = 180 } | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/auto/monitor/start" `
  -Method POST -Body $body -ContentType "application/json"

# 2. ç«‹å³æª¢æŸ¥æº«åº¦
Invoke-RestMethod -Uri "http://127.0.0.1:5000/auto/check"

# 3. æŸ¥çœ‹è¨­å‚™ç‹€æ…‹
Invoke-RestMethod -Uri "http://127.0.0.1:5000/device/state"
```

---

### æƒ…å¢ƒ 3ï¼šæ¯”è¼ƒå¤å­£èˆ‡å†¬å­£ç”¨é›»

```powershell
# 1. ç”¢ç”Ÿå¤å­£æ•¸æ“šï¼ˆ7æœˆï¼‰
$body = @{
    start_date = "2025-07-01"
    end_date = "2025-07-31"
    save_to_db = $true
} | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/range" `
  -Method POST -Body $body -ContentType "application/json"

# 2. ç”¢ç”Ÿå†¬å­£æ•¸æ“šï¼ˆ12æœˆï¼‰
$body = @{
    start_date = "2025-12-01"
    end_date = "2025-12-31"
    save_to_db = $true
} | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/range" `
  -Method POST -Body $body -ContentType "application/json"

# 3. æ¯”è¼ƒå…©å€‹æœˆä»½
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/compare?period_type=month&date1=2025-07&date2=2025-12"
```

---

## ğŸ” é‡è¦è§€å¿µé‡æ¸…

### â“ `/usage/daily` ç‚ºä»€éº¼æ²’é¡¯ç¤º 12 æœˆæ•¸æ“šï¼Ÿ

**åŸå› ï¼šé è¨­åªé¡¯ç¤ºè¿‘ 7 å¤©**

```python
# ç¨‹å¼é‚è¼¯
end_date = date.today()              # ä»Šå¤©ï¼ˆ11/30ï¼‰
start_date = end_date - timedelta(days=6)  # å¾€å‰ 6 å¤©ï¼ˆ11/24ï¼‰

# æŸ¥è©¢ç¯„åœï¼š2025-11-24 ~ 2025-11-30
# 12 æœˆçš„æ•¸æ“šä¸åœ¨æ­¤ç¯„åœå…§ï¼
```

**è§£æ±ºæ–¹æ³•ï¼š**
```powershell
# æ‰‹å‹•æŒ‡å®šæ—¥æœŸç¯„åœ
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/daily?start_date=2025-12-01&end_date=2025-12-07"
```

---

### â“ æ¨¡æ“¬å™¨ç”¢ç”Ÿçš„æ•¸æ“šåœ¨å“ªè£¡ï¼Ÿ

**æµç¨‹ï¼š**
```
POST /simulate/daily
    â†“
å¯«å…¥ power_logs è¡¨
    â†“
GET /usage/daily è®€å–
    â†“
é¡¯ç¤ºæ•¸æ“šï¼ˆç„¡å·®ç•°ï¼‰
```

**é©—è­‰ï¼š**
```powershell
# 1. ç”¢ç”Ÿæ•¸æ“š
$body = @{ date = "2025-12-10"; save_to_db = $true } | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/daily" `
  -Method POST -Body $body -ContentType "application/json"

# 2. æŸ¥è©¢æ•¸æ“šï¼ˆå¿…é ˆæŒ‡å®šæ—¥æœŸï¼‰
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/daily?start_date=2025-12-10&end_date=2025-12-10"
```

---

### â“ å¦‚ä½•æ¸…ç©ºæ¸¬è©¦æ•¸æ“šï¼Ÿ

```sql
-- ç›´æ¥åœ¨ MySQL ä¸­åŸ·è¡Œ
DELETE FROM power_logs WHERE log_date >= '2025-12-01';
```

æˆ–è€…åªåˆªé™¤ç‰¹å®šæ—¥æœŸï¼š
```sql
DELETE FROM power_logs WHERE log_date = '2025-12-10';
```

---

## ğŸ“š æ–‡ä»¶è³‡æº

| æ–‡ä»¶åç¨± | ç”¨é€” | é æ•¸ |
|---------|------|------|
| **ç³»çµ±æ“ä½œæŒ‡å—.md**ï¼ˆæœ¬æ–‡ä»¶ï¼‰ | å®Œæ•´æ“ä½œæµç¨‹ | - |
| **å‰ç«¯æ•´åˆæŒ‡å—.md** | æ‰€æœ‰ API æ–‡ä»¶ | 15 é  |
| **SIMULATOR_GUIDE.md** | æ¨¡æ“¬å™¨è©³ç´°èªªæ˜ | 17 é  |
| **SIMULATOR_QUICKSTART.md** | æ¨¡æ“¬å™¨å¿«é€Ÿä¸Šæ‰‹ | 5 é  |
| **SIMULATOR_README.md** | æ¨¡æ“¬å™¨ç³»çµ±èªªæ˜ | 10 é  |
| **AUTO_CONTROL_GUIDE.md** | æº«åº¦æ§åˆ¶ä½¿ç”¨ | 8 é  |

---

## âœ… ç³»çµ±æª¢æŸ¥æ¸…å–®

### ç’°å¢ƒæª¢æŸ¥
- [ ] Python 3.11 å·²å®‰è£
- [ ] MySQL 8.0 é‹ä½œä¸­
- [ ] è³‡æ–™åº« `smart_home_db` å·²å»ºç«‹
- [ ] æ‰€æœ‰ Python å¥—ä»¶å·²å®‰è£ï¼ˆ`pip install -r requirements.txt`ï¼‰

### åŠŸèƒ½æª¢æŸ¥
- [ ] Flask ä¼ºæœå™¨å¯æ­£å¸¸å•Ÿå‹•
- [ ] å¯è¨ªå• `http://127.0.0.1:5000`
- [ ] `/device/state` API æ­£å¸¸å›æ‡‰
- [ ] `/usage/daily` API æœ‰è³‡æ–™å›å‚³
- [ ] æ¨¡æ“¬å™¨å¯ç”¢ç”Ÿæ•¸æ“š
- [ ] æº«åº¦æ§åˆ¶åŠŸèƒ½æ­£å¸¸

### æ•¸æ“šæª¢æŸ¥
- [ ] è³‡æ–™åº«æœ‰åŸºæœ¬è¨­å‚™è¨˜éŒ„ï¼ˆDevice è¡¨ï¼‰
- [ ] æœ‰æ­·å²ç”¨é›»è¨˜éŒ„ï¼ˆPowerLog è¡¨ï¼‰
- [ ] å¯ç”¨æ¨¡æ“¬å™¨ç”¢ç”Ÿæ¸¬è©¦æ•¸æ“š

---

## ğŸš¨ ç–‘é›£æ’è§£

### å•é¡Œ 1ï¼šç„¡æ³•é€£æ¥è‡³é ç«¯ä¼ºæœå™¨
**åŸå› **ï¼šFlask ä¼ºæœå™¨æœªå•Ÿå‹•  
**è§£æ³•**ï¼šåŸ·è¡Œ `python app.py`

### å•é¡Œ 2ï¼šModuleNotFoundError
**åŸå› **ï¼šç¼ºå°‘ Python å¥—ä»¶  
**è§£æ³•**ï¼š
```powershell
pip install flask flask-sqlalchemy pymysql python-dotenv
```

### å•é¡Œ 3ï¼šè³‡æ–™åº«é€£æ¥å¤±æ•—
**åŸå› **ï¼šMySQL æœªå•Ÿå‹•æˆ–å¯†ç¢¼éŒ¯èª¤  
**è§£æ³•**ï¼š
1. æª¢æŸ¥ MySQL æœå‹™æ˜¯å¦é‹ä½œ
2. ç¢ºèª `config.py` ä¸­çš„è³‡æ–™åº«å¯†ç¢¼

### å•é¡Œ 4ï¼šæ¨¡æ“¬å™¨æ²’ç”¢ç”Ÿæ•¸æ“š
**åŸå› **ï¼š`save_to_db` è¨­ç‚º `false`  
**è§£æ³•**ï¼šç¢ºèª JSON body ä¸­ `"save_to_db": true`

### å•é¡Œ 5ï¼š`/usage/daily` æ²’æœ‰æ•¸æ“š
**åŸå›  A**ï¼šè³‡æ–™åº«çœŸçš„æ²’æœ‰è³‡æ–™  
**è§£æ³• A**ï¼šç”¨æ¨¡æ“¬å™¨ç”¢ç”Ÿæ•¸æ“š

**åŸå›  B**ï¼šæ•¸æ“šä¸åœ¨é è¨­ 7 å¤©ç¯„åœå…§  
**è§£æ³• B**ï¼šæ‰‹å‹•æŒ‡å®šæ—¥æœŸåƒæ•¸
```powershell
?start_date=2025-12-01&end_date=2025-12-07
```

---

## ğŸ’¡ çµ¦å‰ç«¯é–‹ç™¼è€…çš„å»ºè­°

### 1. å…ˆç”¨ PowerShell æ¸¬è©¦ API
åœ¨å¯«å‰ç«¯ä»£ç¢¼ä¹‹å‰ï¼Œå…ˆç”¨ PowerShell ç¢ºèª API å›æ‡‰æ ¼å¼ï¼š
```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:5000/usage/daily"
```

### 2. ç”¢ç”Ÿå›ºå®šæ¸¬è©¦æ•¸æ“š
ä½¿ç”¨ç›¸åŒçš„ `seed` ç¢ºä¿æ‰€æœ‰çµ„å“¡æ•¸æ“šä¸€è‡´ï¼š
```powershell
$body = @{ start_date = "2025-01-01"; end_date = "2025-12-31"; save_to_db = $true; seed = 2025 } | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5000/simulate/range" -Method POST -Body $body -ContentType "application/json"
```

### 3. JavaScript Fetch ç¯„ä¾‹
```javascript
// æŸ¥è©¢æ¯æ—¥ç”¨é›»
fetch('http://127.0.0.1:5000/usage/daily')
  .then(response => response.json())
  .then(data => {
    console.log(data);
    // æ¸²æŸ“åˆ°é é¢
  });

// åˆ‡æ›è¨­å‚™é–‹é—œ
fetch('http://127.0.0.1:5000/device/toggle', {
  method: 'PATCH',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({name: 'å®¢å»³å†·æ°£', on: true})
})
  .then(response => response.json())
  .then(data => console.log(data));
```

---

## ğŸ“ å­¸ç¿’è·¯å¾‘å»ºè­°

### æ–°æ‰‹å…¥é–€ï¼ˆç¬¬ 1 å¤©ï¼‰
1. é–±è®€æœ¬æ–‡ä»¶ã€Œå¿«é€Ÿé–‹å§‹ã€ç« ç¯€
2. å•Ÿå‹•ä¼ºæœå™¨ä¸¦æ¸¬è©¦ `/device/state` API
3. ç”¨æ¨¡æ“¬å™¨ç”¢ç”Ÿ 3 å¤©æ•¸æ“š
4. æŸ¥è©¢ `/usage/daily` é©—è­‰æ•¸æ“š

### é€²éšä½¿ç”¨ï¼ˆç¬¬ 2-3 å¤©ï¼‰
1. æ¸¬è©¦æ‰€æœ‰ 4 å¤§åŠŸèƒ½çš„ API
2. é–±è®€ã€Œå‰ç«¯æ•´åˆæŒ‡å—.mdã€
3. ç”¨ JavaScript å¯«ç°¡å–®æ¸¬è©¦é é¢
4. ç†è§£æ¨¡æ“¬å™¨é‹ä½œåŸç†

### æ·±å…¥é–‹ç™¼ï¼ˆç¬¬ 4-7 å¤©ï¼‰
1. é–±è®€åŸå§‹ç¢¼ç†è§£é‚è¼¯
2. èª¿æ•´æ¨¡æ“¬å™¨åƒæ•¸ï¼ˆ`DEVICE_PROFILES`ï¼‰
3. é–‹ç™¼å®Œæ•´å‰ç«¯é é¢
4. æ•´åˆåœ–è¡¨åº«ï¼ˆChart.js / EChartsï¼‰

---

**æ–‡ä»¶ç‰ˆæœ¬**ï¼šv1.0  
**å»ºç«‹æ—¥æœŸ**ï¼š2025-11-30  
**ç¶­è­·åœ˜éšŠ**ï¼šSmart Energy é–‹ç™¼åœ˜éšŠ  
**æŠ€è¡“æ”¯æ´**ï¼šåƒè€ƒå„æ¨¡çµ„æ–‡ä»¶æˆ–è«®è©¢å¾Œç«¯åœ˜éšŠ
