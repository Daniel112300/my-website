# åŸ·è¡Œèˆ‡æ¸¬è©¦æŒ‡å—

## ğŸš€ å¦‚ä½•åŸ·è¡Œ feature_daily_usage.py

### æ­¥é©Ÿ 1ï¼šå•Ÿå‹• Flask ä¼ºæœå™¨

æ‰“é–‹ç¬¬ä¸€å€‹çµ‚ç«¯æ©Ÿè¦–çª—ï¼š

```powershell
cd "d:\é€¢ç”²åŠŸèª²\å¤§ä¸‰\å¤§ä¸‰_ä¸Š\è»Ÿé«”å·¥ç¨‹é–‹ç™¼å¯¦å‹™\my-website\smart-energy"
python app.py
```

æ‚¨æ‡‰è©²æœƒçœ‹åˆ°ï¼š
```
 * Serving Flask app 'app'
 * Debug mode: on
 * Running on http://127.0.0.1:5000
```

**ä¿æŒé€™å€‹è¦–çª—é–‹è‘—**ï¼Œä¸è¦é—œé–‰ï¼

---

### æ­¥é©Ÿ 2ï¼šæ¸¬è©¦ APIï¼ˆæ–¹æ³•ä¸€ï¼šä½¿ç”¨æ¸¬è©¦è…³æœ¬ï¼‰

æ‰“é–‹ç¬¬äºŒå€‹çµ‚ç«¯æ©Ÿè¦–çª—ï¼š

```powershell
cd "d:\é€¢ç”²åŠŸèª²\å¤§ä¸‰\å¤§ä¸‰_ä¸Š\è»Ÿé«”å·¥ç¨‹é–‹ç™¼å¯¦å‹™\my-website\smart-energy"
python test_api.py
```

é€™å€‹è…³æœ¬æœƒï¼š
1. æ–°å¢å¹¾ç­†æ¸¬è©¦ç”¨é›»ç´€éŒ„
2. æŸ¥è©¢æ¯æ—¥ç”¨é›»çµ±è¨ˆ
3. æŸ¥è©¢æœˆåº¦é›»è²»
4. é¡¯ç¤º CSV æª”æ¡ˆå…§å®¹

---

### æ­¥é©Ÿ 3ï¼šæ¸¬è©¦ APIï¼ˆæ–¹æ³•äºŒï¼šä½¿ç”¨ curl æˆ–ç€è¦½å™¨ï¼‰

#### æ–°å¢ç”¨é›»ç´€éŒ„ï¼ˆPOSTï¼‰

```powershell
# PowerShell ç‰ˆæœ¬
Invoke-WebRequest -Uri "http://localhost:5000/usage/add" `
  -Method POST `
  -ContentType "application/json" `
  -Body '{"device_id": 1, "kwh": 50, "day": "2025-11-01"}' | Select-Object -Expand Content | ConvertFrom-Json
```

#### æŸ¥è©¢æ¯æ—¥ç”¨é›»ï¼ˆGETï¼‰

åœ¨ç€è¦½å™¨æ‰“é–‹ï¼š
```
http://localhost:5000/usage/daily
```

æˆ–åœ¨ PowerShellï¼š
```powershell
Invoke-WebRequest -Uri "http://localhost:5000/usage/daily" | Select-Object -Expand Content | ConvertFrom-Json
```

#### æŸ¥è©¢æœˆåº¦é›»è²»ï¼ˆGETï¼‰

åœ¨ç€è¦½å™¨æ‰“é–‹ï¼š
```
http://localhost:5000/usage/bill
```

---

### æ­¥é©Ÿ 4ï¼šæª¢æŸ¥ CSV æª”æ¡ˆ

```powershell
# æŸ¥çœ‹ CSV å…§å®¹
Get-Content power_logs.csv

# æˆ–ç”¨ Excel/è¨˜äº‹æœ¬æ‰“é–‹
notepad power_logs.csv
```

æª”æ¡ˆä½ç½®ï¼š
```
d:\é€¢ç”²åŠŸèª²\å¤§ä¸‰\å¤§ä¸‰_ä¸Š\è»Ÿé«”å·¥ç¨‹é–‹ç™¼å¯¦å‹™\my-website\smart-energy\power_logs.csv
```

---

## ğŸ“Š API è·¯ç”±èªªæ˜

| æ–¹æ³• | è·¯ç”± | åŠŸèƒ½ | åƒæ•¸ |
|------|------|------|------|
| POST | `/usage/add` | æ–°å¢ç”¨é›»ç´€éŒ„ | `{"device_id": 1, "kwh": 50, "day": "2025-11-01"}` |
| GET | `/usage/daily` | æŸ¥è©¢æ¯æ—¥ç”¨é›»çµ±è¨ˆ | ç„¡ |
| GET | `/usage/bill` | æŸ¥è©¢æœˆåº¦é›»è²»çµ±è¨ˆ | ç„¡ |

---

## ğŸ“ æ–°å¢ç”¨é›»ç´€éŒ„ç¯„ä¾‹

### ä½¿ç”¨ PowerShell

```powershell
# æ–°å¢è¨­å‚™ 1 çš„ç”¨é›»è¨˜éŒ„
$body = @{
    device_id = 1
    kwh = 50
    day = "2025-11-01"
} | ConvertTo-Json

Invoke-WebRequest -Uri "http://localhost:5000/usage/add" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body
```

### ä½¿ç”¨ Python

```python
import requests

data = {
    "device_id": 1,
    "kwh": 50,
    "day": "2025-11-01"
}

response = requests.post("http://localhost:5000/usage/add", json=data)
print(response.json())
```

---

## ğŸ” CSV æª”æ¡ˆæ ¼å¼

æ–°å¢è¨˜éŒ„å¾Œï¼Œ`power_logs.csv` æœƒåŒ…å«ï¼š

```csv
log_id,device_id,log_date,energy_consumed,cost,electricity_rate,created_at
1732867200,1,2025-11-01,50.0,84.0,1.68,2025-11-29 10:00:00
```

å„æ¬„ä½èªªæ˜ï¼š
- `log_id`: è¨˜éŒ„ IDï¼ˆæ™‚é–“æˆ³è¨˜ï¼‰
- `device_id`: è¨­å‚™ ID
- `log_date`: è¨˜éŒ„æ—¥æœŸ
- `energy_consumed`: ç”¨é›»é‡ï¼ˆåº¦ï¼‰
- `cost`: é›»è²»ï¼ˆè¨­å‚™é‚Šéš›é›»è²»ï¼Œä½¿ç”¨å°é›»ç´¯é€²è²»ç‡è¨ˆç®—ï¼‰
- `electricity_rate`: å¹³å‡è²»ç‡
- `created_at`: å»ºç«‹æ™‚é–“

---

## âš ï¸ å¸¸è¦‹å•é¡Œ

### 1. ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨
**éŒ¯èª¤è¨Šæ¯**ï¼š`Connection refused` æˆ– `ç„¡æ³•é€£ç·š`

**è§£æ±ºæ–¹æ³•**ï¼š
- ç¢ºèª Flask ä¼ºæœå™¨å·²å•Ÿå‹•
- æª¢æŸ¥æ˜¯å¦é¡¯ç¤º `Running on http://127.0.0.1:5000`

### 2. CSV æª”æ¡ˆæ²’æœ‰æ›´æ–°
**å¯èƒ½åŸå› **ï¼š
- å·¥ä½œç›®éŒ„ä¸å°
- æ¬Šé™ä¸è¶³

**è§£æ±ºæ–¹æ³•**ï¼š
```powershell
# æª¢æŸ¥ç•¶å‰ç›®éŒ„
Get-Location

# ç¢ºèªåœ¨æ­£ç¢ºç›®éŒ„
cd "d:\é€¢ç”²åŠŸèª²\å¤§ä¸‰\å¤§ä¸‰_ä¸Š\è»Ÿé«”å·¥ç¨‹é–‹ç™¼å¯¦å‹™\my-website\smart-energy"
```

### 3. ç¼ºå°‘å¥—ä»¶
**éŒ¯èª¤è¨Šæ¯**ï¼š`ModuleNotFoundError: No module named 'xxx'`

**è§£æ±ºæ–¹æ³•**ï¼š
```powershell
pip install flask pandas requests
```

---

## ğŸ“ˆ æ¸¬è©¦æµç¨‹å»ºè­°

1. **å•Ÿå‹•ä¼ºæœå™¨**
2. **æ–°å¢å¹¾ç­†è¨˜éŒ„**ï¼ˆä¸åŒæ—¥æœŸã€ä¸åŒè¨­å‚™ï¼‰
3. **æŸ¥çœ‹ CSV æª”æ¡ˆ**ï¼ˆç¢ºèªæœ‰å¯«å…¥ï¼‰
4. **æŸ¥è©¢ API**ï¼ˆç¢ºèªè¨ˆç®—æ­£ç¢ºï¼‰
5. **æ¯”è¼ƒå…©ç¨®é›»è²»**ï¼ˆcost_sum vs cost_progressiveï¼‰

---

## ğŸ¯ å¿«é€Ÿæ¸¬è©¦æŒ‡ä»¤

```powershell
# çµ‚ç«¯æ©Ÿ 1ï¼šå•Ÿå‹•ä¼ºæœå™¨
python app.py

# çµ‚ç«¯æ©Ÿ 2ï¼šåŸ·è¡Œæ¸¬è©¦
python test_api.py

# æˆ–ç›´æ¥æŸ¥çœ‹ CSV
Get-Content power_logs.csv | Format-Table
```
